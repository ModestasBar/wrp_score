kind: pipeline
name: docker

steps:
  # - name: npm_install
  #   image: node:18-alpine
  #   commands:
  #     - echo $DRONE_REPO_NAME
  #     - npm install
  # - name: npm_build
  #   image: node:18-alpine
  #   commands:
  #     - npm run build
  #   depends_on:
  #     - npm_install
  # - name: build_image
  #   image: drone/docker
  #   volumes:
  #     - name: docker-socket
  #       path: /var/run/docker.sock
  #   commands:
  #     - docker build -t wrp-score:latest .
  #   depends_on:
  #     - npm_build
  - name: publish_image
    image: meisterplan/jfrog-cli
    environment:
      USERNAME:
        from_secret: docker_username
      PASSWORD:
        from_secret: docker_password
    # secrets: [ ARTIFACTORY_PASSWORD, ARTIFACTORY_USERNAME, ARTIFACTORY_URL, ARTIFACTORY_REPO_KEY ]
    commands:
      - jfrog rt config –url=$ARTIFACTORY_URL –user=$ARTIFACTORY_USERNAME –password=$ARTIFACTORY_PASSWORD
      - 'jfrog rt c show'
      - jfrog rt bp wrp-score:latest 
volumes:
  - name: docker-socket
    host:
      path: /var/run/docker.sock
